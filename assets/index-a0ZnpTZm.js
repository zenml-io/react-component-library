import{a as T,_ as C,c as z}from"./index-ZtSIjf74.js";import{r as n}from"./index-OjgoNOWw.js";import{$ as h}from"./index-_WWFXJ7k.js";import{a as L}from"./index-6Pk-3rAJ.js";import{a as y}from"./index-5NtMBFis.js";function A(r,e=globalThis==null?void 0:globalThis.document){const s=y(r);n.useEffect(()=>{const o=t=>{t.key==="Escape"&&s(t)};return e.addEventListener("keydown",o),()=>e.removeEventListener("keydown",o)},[s,e])}const p="dismissableLayer.update",K="dismissableLayer.pointerDownOutside",N="dismissableLayer.focusOutside";let w;const R=n.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),H=n.forwardRef((r,e)=>{var s;const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:t,onPointerDownOutside:a,onFocusOutside:b,onInteractOutside:u,onDismiss:l,...v}=r,c=n.useContext(R),[d,I]=n.useState(null),f=(s=d==null?void 0:d.ownerDocument)!==null&&s!==void 0?s:globalThis==null?void 0:globalThis.document,[,W]=n.useState({}),B=L(e,i=>I(i)),m=Array.from(c.layers),[k]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),S=m.indexOf(k),O=d?m.indexOf(d):-1,_=c.layersWithOutsidePointerEventsDisabled.size>0,D=O>=S,U=j(i=>{const E=i.target,g=[...c.branches].some($=>$.contains(E));!D||g||(a==null||a(i),u==null||u(i),i.defaultPrevented||l==null||l())},f),P=q(i=>{const E=i.target;[...c.branches].some($=>$.contains(E))||(b==null||b(i),u==null||u(i),i.defaultPrevented||l==null||l())},f);return A(i=>{O===c.layers.size-1&&(t==null||t(i),!i.defaultPrevented&&l&&(i.preventDefault(),l()))},f),n.useEffect(()=>{if(d)return o&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(w=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),x(),()=>{o&&c.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=w)}},[d,f,o,c]),n.useEffect(()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),x())},[d,c]),n.useEffect(()=>{const i=()=>W({});return document.addEventListener(p,i),()=>document.removeEventListener(p,i)},[]),n.createElement(T.div,C({},v,{ref:B,style:{pointerEvents:_?D?"auto":"none":void 0,...r.style},onFocusCapture:h(r.onFocusCapture,P.onFocusCapture),onBlurCapture:h(r.onBlurCapture,P.onBlurCapture),onPointerDownCapture:h(r.onPointerDownCapture,U.onPointerDownCapture)}))}),X=n.forwardRef((r,e)=>{const s=n.useContext(R),o=n.useRef(null),t=L(e,o);return n.useEffect(()=>{const a=o.current;if(a)return s.branches.add(a),()=>{s.branches.delete(a)}},[s.branches]),n.createElement(T.div,C({},r,{ref:t}))});function j(r,e=globalThis==null?void 0:globalThis.document){const s=y(r),o=n.useRef(!1),t=n.useRef(()=>{});return n.useEffect(()=>{const a=u=>{if(u.target&&!o.current){let v=function(){F(K,s,l,{discrete:!0})};const l={originalEvent:u};u.pointerType==="touch"?(e.removeEventListener("click",t.current),t.current=v,e.addEventListener("click",t.current,{once:!0})):v()}else e.removeEventListener("click",t.current);o.current=!1},b=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(b),e.removeEventListener("pointerdown",a),e.removeEventListener("click",t.current)}},[e,s]),{onPointerDownCapture:()=>o.current=!0}}function q(r,e=globalThis==null?void 0:globalThis.document){const s=y(r),o=n.useRef(!1);return n.useEffect(()=>{const t=a=>{a.target&&!o.current&&F(N,s,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",t),()=>e.removeEventListener("focusin",t)},[e,s]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function x(){const r=new CustomEvent(p);document.dispatchEvent(r)}function F(r,e,s,{discrete:o}){const t=s.originalEvent.target,a=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:s});e&&t.addEventListener(r,e,{once:!0}),o?z(t,a):t.dispatchEvent(a)}const Y=H,Z=X;export{H as $,Z as a,Y as b};
