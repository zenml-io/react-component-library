import{a as y,b as k,_ as S,c as _}from"./index-aLhqFf3u.js";import{r}from"./index-OjgoNOWw.js";import{$ as h}from"./index-haQZiOfO.js";import{a as U}from"./index-uxD8nXqh.js";function z(s,e=globalThis==null?void 0:globalThis.document){const i=y(s);r.useEffect(()=>{const o=t=>{t.key==="Escape"&&i(t)};return e.addEventListener("keydown",o),()=>e.removeEventListener("keydown",o)},[i,e])}const p="dismissableLayer.update",A="dismissableLayer.pointerDownOutside",K="dismissableLayer.focusOutside";let w;const N=r.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),M=r.forwardRef((s,e)=>{var i;const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:t,onPointerDownOutside:d,onFocusOutside:v,onInteractOutside:u,onDismiss:l,...b}=s,a=r.useContext(N),[c,L]=r.useState(null),f=(i=c==null?void 0:c.ownerDocument)!==null&&i!==void 0?i:globalThis==null?void 0:globalThis.document,[,x]=r.useState({}),F=U(e,n=>L(n)),O=Array.from(a.layers),[I]=[...a.layersWithOutsidePointerEventsDisabled].slice(-1),R=O.indexOf(I),D=c?O.indexOf(c):-1,W=a.layersWithOutsidePointerEventsDisabled.size>0,P=D>=R,B=H(n=>{const E=n.target,g=[...a.branches].some($=>$.contains(E));!P||g||(d==null||d(n),u==null||u(n),n.defaultPrevented||l==null||l())},f),m=X(n=>{const E=n.target;[...a.branches].some($=>$.contains(E))||(v==null||v(n),u==null||u(n),n.defaultPrevented||l==null||l())},f);return z(n=>{D===a.layers.size-1&&(t==null||t(n),!n.defaultPrevented&&l&&(n.preventDefault(),l()))},f),r.useEffect(()=>{if(c)return o&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(w=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(c)),a.layers.add(c),T(),()=>{o&&a.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=w)}},[c,f,o,a]),r.useEffect(()=>()=>{c&&(a.layers.delete(c),a.layersWithOutsidePointerEventsDisabled.delete(c),T())},[c,a]),r.useEffect(()=>{const n=()=>x({});return document.addEventListener(p,n),()=>document.removeEventListener(p,n)},[]),r.createElement(k.div,S({},b,{ref:F,style:{pointerEvents:W?P?"auto":"none":void 0,...s.style},onFocusCapture:h(s.onFocusCapture,m.onFocusCapture),onBlurCapture:h(s.onBlurCapture,m.onBlurCapture),onPointerDownCapture:h(s.onPointerDownCapture,B.onPointerDownCapture)}))});function H(s,e=globalThis==null?void 0:globalThis.document){const i=y(s),o=r.useRef(!1),t=r.useRef(()=>{});return r.useEffect(()=>{const d=u=>{if(u.target&&!o.current){let b=function(){C(A,i,l,{discrete:!0})};const l={originalEvent:u};u.pointerType==="touch"?(e.removeEventListener("click",t.current),t.current=b,e.addEventListener("click",t.current,{once:!0})):b()}else e.removeEventListener("click",t.current);o.current=!1},v=window.setTimeout(()=>{e.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(v),e.removeEventListener("pointerdown",d),e.removeEventListener("click",t.current)}},[e,i]),{onPointerDownCapture:()=>o.current=!0}}function X(s,e=globalThis==null?void 0:globalThis.document){const i=y(s),o=r.useRef(!1);return r.useEffect(()=>{const t=d=>{d.target&&!o.current&&C(K,i,{originalEvent:d},{discrete:!1})};return e.addEventListener("focusin",t),()=>e.removeEventListener("focusin",t)},[e,i]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function T(){const s=new CustomEvent(p);document.dispatchEvent(s)}function C(s,e,i,{discrete:o}){const t=i.originalEvent.target,d=new CustomEvent(s,{bubbles:!1,cancelable:!0,detail:i});e&&t.addEventListener(s,e,{once:!0}),o?_(t,d):t.dispatchEvent(d)}export{M as $};
